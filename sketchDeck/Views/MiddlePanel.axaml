<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:sketchDeck.Models"
             xmlns:vm="clr-namespace:sketchDeck.ViewModels"
             xmlns:local="clr-namespace:sketchDeck"
             xmlns:conv="clr-namespace:sketchDeck.ViewModels"
             xmlns:ir="using:Avalonia.Controls"
             x:Class="sketchDeck.Views.MiddlePanel"
             x:DataType="vm:MiddlePanelViewModel">

    <UserControl.Resources>
        <DataTemplate x:Key="DetailsTemplate" x:DataType="vm:MiddlePanelViewModel">
            <DataGrid ItemsSource="{Binding Images}"
                    AutoGenerateColumns="False"
                    HeadersVisibility="Column"
                    CanUserResizeColumns="True"
                    IsReadOnly="True">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Width="64">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Image Source="{Binding Thumbnail, Converter={StaticResource ThumbnailConverter}}" Width="48" Height="48" Margin="10"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="96"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" />
                    <DataGridTextColumn Header="Size" Binding="{Binding Size}" />
                    <DataGridTextColumn Header="Date" Binding="{Binding DateModified}" />
                </DataGrid.Columns>
            </DataGrid>
        </DataTemplate>
        <DataTemplate x:Key="SmallTemplate" x:DataType="vm:MiddlePanelViewModel">
            <ScrollViewer>
                <ir:ItemsRepeater ItemsSource="{Binding Images}">
                    <ir:ItemsRepeater.Layout>
                        <WrapLayout Orientation="Horizontal" />
                    </ir:ItemsRepeater.Layout>

                    <ir:ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="10" Width="148" DoubleTapped="OnImageDoubleTapped">
                                <Image Source="{Binding Thumbnail, Converter={StaticResource ThumbnailConverter}}" 
                                    Width="128" Height="128"
                                    Stretch="Uniform"/>
                                <TextBlock Text="{Binding Name}" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,4,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ir:ItemsRepeater.ItemTemplate>
                </ir:ItemsRepeater>
            </ScrollViewer>
        </DataTemplate>
        <DataTemplate x:Key="MediumTemplate" x:DataType="vm:MiddlePanelViewModel">
            <ScrollViewer>
                <ir:ItemsRepeater ItemsSource="{Binding Images}">
                    <ir:ItemsRepeater.Layout>
                        <WrapLayout Orientation="Horizontal" />
                    </ir:ItemsRepeater.Layout>

                    <ir:ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="10" Width="276" DoubleTapped="OnImageDoubleTapped">
                                <Image Source="{Binding Thumbnail, Converter={StaticResource ThumbnailConverter}}" 
                                    Width="256" Height="256"
                                    Stretch="Uniform"/>
                                <TextBlock Text="{Binding Name}" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,4,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ir:ItemsRepeater.ItemTemplate>
                </ir:ItemsRepeater>
            </ScrollViewer>
        </DataTemplate>
        <DataTemplate x:Key="BigTemplate" x:DataType="vm:MiddlePanelViewModel">
            <ScrollViewer>
                <ir:ItemsRepeater ItemsSource="{Binding Images}">
                    <ir:ItemsRepeater.Layout>
                        <WrapLayout Orientation="Horizontal" />
                    </ir:ItemsRepeater.Layout>

                    <ir:ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="10" Width="376" DoubleTapped="OnImageDoubleTapped">
                                <Image Source="{Binding Thumbnail, Converter={StaticResource ThumbnailConverter}}" 
                                    Width="356" Height="356"
                                    Stretch="Uniform"/>
                                <TextBlock Text="{Binding Name}" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,4,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ir:ItemsRepeater.ItemTemplate>
                </ir:ItemsRepeater>
            </ScrollViewer>
        </DataTemplate>
        <DataTemplate x:Key="GiganticTemplate" x:DataType="vm:MiddlePanelViewModel">
            <ScrollViewer>
                <ir:ItemsRepeater ItemsSource="{Binding Images}">
                    <ir:ItemsRepeater.Layout>
                        <WrapLayout Orientation="Horizontal" />
                    </ir:ItemsRepeater.Layout>

                    <ir:ItemsRepeater.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="10" Width="532" DoubleTapped="OnImageDoubleTapped">
                                <Image Source="{Binding Thumbnail, Converter={StaticResource ThumbnailConverter}}" 
                                    Width="512" Height="512"
                                    Stretch="Uniform"/>
                                <TextBlock Text="{Binding Name}" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,4,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ir:ItemsRepeater.ItemTemplate>
                </ir:ItemsRepeater>
            </ScrollViewer>
        </DataTemplate>
        <conv:ViewToTemplateConverter x:Key="ViewToTemplateConverter"
                                Details="{StaticResource DetailsTemplate}"
                                Small="{StaticResource SmallTemplate}"
                                Medium="{StaticResource MediumTemplate}"
                                Big="{StaticResource BigTemplate}"
                                Gigantic="{StaticResource GiganticTemplate}"/>
        <conv:ThumbnailConverter x:Key="ThumbnailConverter" />
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,Auto,*" Background="#1E1E1E">
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*" Margin="10" ColumnSpacing="8" HorizontalAlignment="Right">
            <Button Width="32" Height="25" Cursor="Hand" HorizontalContentAlignment="Center" VerticalContentAlignment="Center">
                <Path Data="M12 5 V19 M5 12 H19"
                      Stretch="Uniform" Stroke="White" StrokeThickness="2.7"
                      StrokeLineCap="Round" Width="12" Height="12"/>
            </Button>

            <ComboBox Grid.Column="1"
                      ItemsSource="{Binding Views}"
                      SelectedItem="{Binding SelectedView, Mode=TwoWay}"
                      MinHeight="25" FontSize="12" Cursor="Hand"/>
        </Grid>

        <TextBox Grid.Row="1" Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}" Margin="10,0,10,10" Watermark="Search..." Height="30"/>
        <ContentControl Margin="10,0,10,10" Grid.Row="2" Content="{Binding}" ContentTemplate="{Binding SelectedView, Converter={StaticResource ViewToTemplateConverter}}"/>
    </Grid>
</UserControl>